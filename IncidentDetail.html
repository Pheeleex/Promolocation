<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Incident Detail</title>
    <link rel="stylesheet" href="css/IncidentDetail.css" />
    <link rel="stylesheet" href="css/index.css" />
  </head>

  <body>
    <div class="page-container">
      <aside class="sidebar">
        <div class="sidebar-logo">
          <img src="./assets/auth-logo.png" alt="Main Logo" />
        </div>

        <nav class="sidebar-nav">
          <ul>
            <li>
              <a href="/Promoters.html">
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  width="24"
                  height="24"
                  viewBox="0 0 24 24"
                  fill="white"
                  stroke="white"
                  stroke-width="2"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  class="lucide lucide-user-round-icon lucide-user-round"
                >
                  <circle cx="12" cy="8" r="5" />
                  <path d="M20 21a8 8 0 0 0-16 0" />
                </svg>
                <span>Promoters List</span>
              </a>
            </li>
            <li>
              <a href="AddPromoters.html">
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  width="24"
                  height="24"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  class="lucide lucide-user-round-plus-icon lucide-user-round-plus"
                >
                  <path d="M2 21a8 8 0 0 1 13.292-6" />
                  <circle cx="10" cy="8" r="5" />
                  <path d="M19 16v6" />
                  <path d="M22 19h-6" />
                </svg>
                <span>Add New Promoters</span>
              </a>
            </li>
            <li>
              <a href="/IncidentHistory.html">
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  width="24"
                  height="24"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  class="lucide lucide-clipboard-clock-icon lucide-clipboard-clock"
                >
                  <path d="M16 14v2.2l1.6 1" />
                  <path d="M16 4h2a2 2 0 0 1 2 2v.832" />
                  <path d="M8 4H6a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h2" />
                  <circle cx="16" cy="16" r="6" />
                  <rect x="8" y="2" width="8" height="4" rx="1" />
                </svg>
                <span>Incident History</span>
              </a>
            </li>
          </ul>
        </nav>

        <div class="sidebar-footer">
          <button class="logout-link" onclick="openLogoutModal()">
            <img src="./assets/Frame1.png" alt="" /> <span>Logout</span>
          </button>
        </div>
      </aside>

      <main class="main-content">
        <div class="detail-wrapper">
          <button class="back-btn" onclick="history.back()">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="16"
              height="16"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2.5"
              stroke-linecap="round"
              stroke-linejoin="round"
            >
              <path d="M19 12H5" />
              <path d="M12 19l-7-7 7-7" />
            </svg>
            Back to Incident History
          </button>

          <h1 class="page-title">Incident Details</h1>

          <!-- SINGLE UNIFIED CARD -->
          <div class="incident-card">
            <!-- TOP: Report details (left) + Photo (right) -->
            <div class="incident-top">
              <!-- LEFT: Incident Report -->
              <div class="report-section">
                <h3 class="card-section-title">Incident Report:</h3>
                <div class="report-rows">
                  <div class="report-row">
                    <span class="row-label">Name:</span>
                    <span class="row-value" id="detailName">—</span>
                  </div>
                  <div class="report-row">
                    <span class="row-label">Email:</span>
                    <span class="row-value" id="detailEmail">—</span>
                  </div>
                  <div class="report-row">
                    <span class="row-label">User ID:</span>
                    <span class="row-value" id="detailUserId">—</span>
                  </div>
                  <div class="report-row">
                    <span class="row-label">Role:</span>
                    <span class="row-value" id="detailRole">—</span>
                  </div>
                  <div class="report-row">
                    <span class="row-label">Date &amp; Time:</span>
                    <span class="row-value" id="detailDate">—</span>
                  </div>
                  <div class="report-row">
                    <span class="row-label">Assigned Region:</span>
                    <span class="row-value" id="detailRegion">—</span>
                  </div>
                  <div class="report-row">
                    <span class="row-label">Location:</span>
                    <span class="row-value" id="detailLocation">—</span>
                  </div>
                  <div class="report-row">
                    <span class="row-label">Current Status:</span>
                    <span class="row-value status-value">
                      <span id="detailStatusText">—</span>
                      <span id="detailStatusDot" class="status-dot"></span>
                    </span>
                  </div>
                  <div class="report-row last-row">
                    <span class="row-label">Incident Issue:</span>
                    <span class="row-value" id="detailIssue">—</span>
                  </div>
                </div>
              </div>

              <!-- RIGHT: Photo -->
              <div class="photo-section">
                <h3 class="card-section-title">Photo:</h3>
                <div
                  class="photo-frame"
                  id="photoFrame"
                  onclick="openLightbox()"
                ></div>
              </div>
            </div>

            <!-- DIVIDER -->
            <hr class="section-divider" />

            <!-- BOTTOM: Description -->
            <div class="description-section">
              <h3 class="card-section-title">Description:</h3>
              <div class="description-box">
                <p id="detailDescription">—</p>
              </div>
            </div>
          </div>
          <!-- end .incident-card -->

          <!-- MARK AS RESOLVED BUTTON -->
          <div class="resolve-footer">
            <button
              class="resolve-btn"
              id="resolveBtn"
              onclick="markAsResolved()"
            >
              Mark as Resolved
            </button>
          </div>
        </div>
      </main>
    </div>

    <!-- ─── LIGHTBOX ──────────────────────────────────────────── -->
    <div
      class="lightbox-overlay"
      id="lightboxOverlay"
      onclick="closeLightboxOnBackdrop(event)"
    >
      <div class="lightbox-inner">
        <button class="lightbox-close" onclick="closeLightbox()" title="Close">
          &#x2715;
        </button>
        <img id="lightboxImg" src="" alt="Incident Photo" />
      </div>
    </div>

    <!-- ─── LOGOUT MODAL ──────────────────────────────────────── -->
    <div class="logout-overlay" id="logoutOverlay">
      <div
        class="logout-modal"
        role="dialog"
        aria-modal="true"
        aria-labelledby="logoutTitle"
      >
        <div class="logout-icon">
          <svg
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2.2"
            stroke-linecap="round"
            stroke-linejoin="round"
          >
            <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4" />
            <polyline points="16 17 21 12 16 7" />
            <line x1="21" y1="12" x2="9" y2="12" />
          </svg>
        </div>

        <h2 id="logoutTitle">Log Out?</h2>
        <p>
          Are you sure you want to log out?<br />You'll need to sign in again to
          access the admin panel.
        </p>

        <div class="modal-divider"></div>

        <div class="modal-actions">
          <button class="btn-cancel" onclick="closeLogoutModal()">
            Cancel
          </button>
          <button class="btn-confirm" onclick="confirmLogout()">
            Yes, Log Out
          </button>
        </div>
      </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="js/IncidentDetail.js"></script>
    <script src="js/index.js"></script>

    <script>
      /* ─── LIGHTBOX ─────────────────────────────────────────── */
      function openLightbox() {
        const img = document.querySelector("#photoFrame img");
        if (!img) return;
        document.getElementById("lightboxImg").src = img.src;
        document.getElementById("lightboxOverlay").classList.add("active");
        document.body.style.overflow = "hidden";
      }

      function closeLightbox() {
        document.getElementById("lightboxOverlay").classList.remove("active");
        document.body.style.overflow = "";
      }

      function closeLightboxOnBackdrop(e) {
        if (e.target === document.getElementById("lightboxOverlay"))
          closeLightbox();
      }

      document.addEventListener("keydown", function (e) {
        if (e.key === "Escape") closeLightbox();
      });

      /* ─── MARK AS RESOLVED ─────────────────────────────────── */
      function markAsResolved() {
        const btn = document.getElementById("resolveBtn");
        if (btn.classList.contains("resolved")) return;

        Swal.fire({
          title: "Mark as Resolved?",
          text: "This will update the incident status to Resolved.",
          icon: "question",
          showCancelButton: true,
          confirmButtonColor: "#0E2B63",
          cancelButtonColor: "#94a3b8",
          confirmButtonText: "Yes, Resolve It",
          cancelButtonText: "Cancel",
        }).then((result) => {
          if (result.isConfirmed) {
            btn.textContent = "✓ Resolved";
            btn.classList.add("resolved");
            btn.disabled = true;

            const dot = document.getElementById("detailStatusDot");
            const statusText = document.getElementById("detailStatusText");
            if (statusText) statusText.textContent = "Resolved";
            if (dot) dot.style.backgroundColor = "#16a34a";

            Swal.fire({
              title: "Incident Resolved",
              text: "The incident has been marked as resolved.",
              icon: "success",
              confirmButtonColor: "#0E2B63",
            });
          }
        });
      }
    </script>
  </body>
</html>
